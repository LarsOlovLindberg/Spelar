<h2>Om strategin</h2>

<p><strong>Idén är enkel:</strong> vi handlar <em>oavgjort (Draw)</em> som en edge mellan en baseline-sannolikhet (från bookmaker/sportsbook) och Polymarkets pris (≈ sannolikhet). När Draw-token är billigare än vår baseline med tillräcklig marginal köper vi Draw, och går ur när marknaden reprissätter och edgen försvinner.</p>

<div class="grid">
  <div class="card">
    <h4>Vad vi mäter</h4>
    <p class="muted">Priset kommer från Polymarket CLOB (orderbok) – best bid/ask och mid.</p>
    <ul>
      <li><strong>pm_mid_draw</strong>: (bid+ask)/2 för Draw-token</li>
      <li><strong>baseline_p_draw</strong>: vår baseline-sannolikhet för oavgjort (justerad)</li>
      <li><strong>edge_pct</strong>: (baseline − pm_mid) i procentenheter</li>
    </ul>
  </div>
  <div class="card">
    <h4>Så systemet agerar</h4>
    <ul>
      <li>Hittar matchmarknader där Draw finns som outcome (typiskt 1X2)</li>
      <li>Köper Draw när edgen är tillräckligt stor och priset är rimligt</li>
      <li>Säljer/avslutar när edgen krymper (eller när marknaden stänger)</li>
    </ul>
  </div>
</div>

<h3>Viktiga förtydliganden</h3>
<ul>
  <li>Baseline är en <strong>extern referens</strong> (sportsbook-odds → sannolikhet), men priset vi handlar är alltid Polymarket CLOB.</li>
  <li>Strategin är inte byggd för “håll till settlement” som huvudplan; målet är reprissättning (edge in → edge out).</li>
  <li>Vi gör konservativa kvalitetsfilter (likviditet/spread/pris-tak) för att undvika att edgen äts upp av microstructure.</li>
</ul>

<h3>Exakt strategi (pm_draw)</h3>
<p><strong>Syfte:</strong> hitta och handla felprissättning i Draw jämfört med en baseline-sannolikhet. Vi försöker inte vara bäst på att “tippa matchen”; vi försöker vara disciplinerat bättre än marknadens Draw-pris vid vissa tillfällen.</p>

<div class="grid">
  <div class="card" style="grid-column: span 12;">
    <h4>Inputs (per marknad)</h4>
    <ul>
      <li><strong>Pris</strong>: Polymarket CLOB best bid/ask och mid för Draw-token.</li>
      <li><strong>Tid</strong>: tick-loop (typiskt var <span class="mono">INTERVAL_S</span> sekund).</li>
      <li><strong>Baseline</strong>: Draw-sannolikhet från fil (<span class="mono">PM_DRAW_BASELINE_FILE</span>) eller fallback (<span class="mono">PM_DRAW_BASELINE_P</span>), ev. justerad av <span class="mono">PM_DRAW_BOOK_PROB_MULT</span>.</li>
      <li><strong>Urval</strong>: marknader hittas via Gamma-scan (och/eller market_map).</li>
    </ul>
  </div>
</div>

<div class="grid">
  <div class="card">
    <h4>Definitioner</h4>
    <ul>
      <li><strong>pm_mid_draw</strong>: Polymarkets Draw-mid (≈ marknadens draw-prob).</li>
      <li><strong>baseline_p_draw</strong>: baseline draw-sannolikhet (från bookmaker eller fallback), ev. konservativt justerad.</li>
      <li><strong>edge_pct</strong>: (baseline_p_draw − pm_mid_draw) · 100.</li>
      <li><strong>gates</strong>: pris-tak + spread/likviditet + freshness innan handel tillåts.</li>
    </ul>
  </div>
  <div class="card">
    <h4>3-vägs marknader (1X2)</h4>
    <ul>
      <li>För riktiga match-draw vill vi oftast ha 3 outcomes: Home / Draw / Away (<span class="mono">PM_DRAW_REQUIRE_3WAY</span>).</li>
      <li>Vi handlar specifikt Draw-outcome, inte “Draw” i andra typer av marknader (t.ex. e-sport maps).</li>
      <li>Som extra kvalitetsfilter kan vi kräva rimlig favoritstyrka via <span class="mono">PM_DRAW_FAV_MIN</span>/<span class="mono">PM_DRAW_FAV_MAX</span>.</li>
    </ul>
  </div>
</div>

<div class="grid">
  <div class="card" style="grid-column: span 12;">
    <h4>Per tick (pseudo)</h4>
    <pre class="mono" style="white-space:pre-wrap;line-height:1.35;">
for each market:
  1) fetch PM orderbook for Draw token (bid/ask/mid)
  2) load baseline draw probability (file or fallback)
  3) compute edge_pct = (baseline_p_draw - pm_mid_draw) * 100
  4) entry gates:
       - edge_pct >= PM_DRAW_EDGE_MIN_PCT
       - pm_mid_draw <= PM_DRAW_MAX_PRICE
       - basic spread/liquidity/freshness ok
  5) if enter_ok: paper BUY Draw
  6) if in position:
       - exit when edge fades: edge_pct <= PM_DRAW_EDGE_EXIT_PCT
       - or when market is closing/closed
    </pre>
    <p class="muted">Obs: flera generella risk-gates har legacy-prefix (<span class="mono">LEAD_LAG_*</span>), men de fungerar som kostnads-/likviditetsfilter även här.</p>
  </div>
</div>

<div class="grid">
  <div class="card">
    <h4>Positionsstorlek (viktig detalj)</h4>
    <p class="muted">Systemet undviker inte automatiskt “små marknader” — det skalar ner.</p>
    <ul>
      <li>Start: <span class="mono">PM_ORDER_SIZE_SHARES</span>.</li>
      <li>Cap 1: <span class="mono">LEAD_LAG_HARD_CAP_USDC</span> (absolut tak).</li>
      <li>Cap 2: band-likviditet i orderboken inom slippage-bandet * <span class="mono">LEAD_LAG_MAX_FRACTION_OF_BAND_LIQUIDITY</span>.</li>
      <li>Om den cap:ade storleken blir för liten (&lt; <span class="mono">LEAD_LAG_MIN_TRADE_NOTIONAL_USDC</span>) → skip med skäl <span class="mono">insufficient_liquidity</span>.</li>
    </ul>
  </div>
  <div class="card">
    <h4>Var man ser att det funkar</h4>
    <ul>
      <li><span class="mono">edge_calculator_live.csv</span>: edge-komponenter + <em>reason</em> när det blir trade/skip.</li>
      <li><span class="mono">pm_paper_candidates.csv</span>: per marknad: decision + reason (varför det blev trade/skip).</li>
      <li><span class="mono">pm_paper_trades.csv</span>: paper fills/skips.</li>
      <li><span class="mono">live_status.json</span>: gates, latens, och senaste tick-status.</li>
    </ul>
  </div>
</div>

<div class="grid">
  <div class="card" style="grid-column: span 12;">
    <h4>Gå vidare</h4>
    <p class="muted">Nästa steg: se hur logiken ser ut i praktiken — och jämför med verkliga snapshots.</p>
    <div class="actions" style="justify-content:flex-start;">
      <a class="btn" href="#/strategy/flow">2.2 Hur systemet tänker</a>
      <a class="btn" href="#/data">Data & exempel</a>
    </div>
  </div>
</div>
