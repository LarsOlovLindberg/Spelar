<h2>Om strategin</h2>

<p><strong>Idén är enkel:</strong> ibland hinner priset på en marknad ändras innan en annan marknad “hänger med”. Den tillfälliga skillnaden kallar vi en <em>edge</em>.</p>

<div class="grid">
  <div class="card">
    <h4>Vad en edge är</h4>
    <p class="muted">En edge är en temporär prisskillnad mellan två platser där samma sak värderas.</p>
    <ul>
      <li>Den kan vara liten</li>
      <li>Den kan vara kortvarig</li>
      <li>Den kan försvinna snabbt när marknaderna synkar</li>
    </ul>
  </div>
  <div class="card">
    <h4>Så systemet arbetar</h4>
    <ul>
      <li>Identifierar när en snabb marknad leder</li>
      <li>Går in i en långsammare marknad</li>
      <li>Lämnar när marknaderna är i synk igen</li>
    </ul>
  </div>
</div>

<h3>Viktiga förtydliganden</h3>
<ul>
  <li>Ingen exponering mot slututfall</li>
  <li>Ingen “håll till slutet”-logik</li>
  <li>Fokus är tidsbegränsad edge, inte prognoser</li>
</ul>

<p class="muted">Tänk “eftersläpning”: som när en skylt på motorvägen uppdateras någon sekund efter att GPS:en redan visat avfarten.</p>

<h3>Exakt strategi (lead–lag, microstructure)</h3>
<p><strong>Syfte:</strong> utnyttja att Kraken spot ofta rör sig före Polymarket CLOB (orderboken) och att PM-priset “släpar”. Systemet försöker <em>inte</em> förutsäga slututfall; det försöker fånga kortvariga prisjusteringar.</p>

<div class="grid">
  <div class="card" style="grid-column: span 12;">
    <h4>Inputs (per marknad)</h4>
    <ul>
      <li><strong>Lead</strong>: Kraken spot pris för ett par (t.ex. <span class="mono">XBTUSD</span>).</li>
      <li><strong>Lag</strong>: Polymarket CLOB best bid/ask och mid för en outcome-token.</li>
      <li><strong>Tid</strong>: tick-loop (typiskt var <span class="mono">INTERVAL_S</span> sekund).</li>
      <li><strong>Konfig</strong>: thresholds/gates via env (t.ex. <span class="mono">LEAD_LAG_*</span>, <span class="mono">FRESHNESS_MAX_AGE_SECS</span>).</li>
    </ul>
  </div>
</div>

<div class="grid">
  <div class="card">
    <h4>Definitioner</h4>
    <ul>
      <li><strong>spot_ret_pct</strong>: procentuell spot-rörelse över ett kort fönster (N punkter).</li>
      <li><strong>pm_ret_pct</strong>: motsvarande rörelse för PM mid.</li>
      <li><strong>edge_pct</strong>: skillnaden mellan spot och PM i procentenheter.</li>
      <li><strong>spread_cost_pct</strong>: uppskattad kostnad i procentenheter från half-spread (entry vs mid).</li>
      <li><strong>fees_pct</strong>: uppskattad fee + extra cost (konfig) i procentenheter.</li>
      <li><strong>net_edge_pct</strong> = edge_pct − spread_cost_pct − fees_pct.</li>
    </ul>
  </div>
  <div class="card">
    <h4>Signalriktning (YES/NO)</h4>
    <ul>
      <li><strong>YES</strong>: edge följer spot upp (edge ≈ spot_ret − pm_ret).</li>
      <li><strong>NO</strong>: en nedgång i spot behandlas som “positiv rörelse” (edge ≈ (−spot_ret) − pm_ret).</li>
    </ul>
  </div>
</div>

<div class="grid">
  <div class="card" style="grid-column: span 12;">
    <h4>Per tick (pseudo)</h4>
    <pre class="mono" style="white-space:pre-wrap;line-height:1.35;">
for each market:
  1) fetch PM orderbook (bid/ask/mid)
  2) fetch Kraken spot price (cached per pair per tick)
  3) update rolling history and compute:
       spot_ret_pct, pm_ret_pct, edge_pct
  4) compute spread_cost_pct from PM bid/ask
  5) compute adaptive move threshold:
       move_min_dyn = max(
         base_move_min,
         noise_mult * spot_noise_std,
         spread_move_mult * spread_cost_pct
       )
  6) entry precondition:
       spot_move_ok AND edge_pct >= LEAD_LAG_EDGE_MIN_PCT
  7) quality gates (after-cost & microstructure):
       - lag gate (optional): if lag estimate exists, require lag_ms >= LEAD_LAG_MIN_MARKET_LAG_MS
       - spread gate: spread_cost_pct <= LEAD_LAG_SPREAD_COST_CAP_PCT
       - net edge gate: net_edge_pct >= LEAD_LAG_NET_EDGE_MIN_PCT
       - liquidity gate: cap size by visible band liquidity (ask..ask+slippage_cap)
       - min notional: require max_usdc >= LEAD_LAG_MIN_TRADE_NOTIONAL_USDC
       - throttle: max orders per tick
  8) if enter_ok: place a paper buy/sell (or log decision)
  9) if in position: exit on edge fade / stop / max hold
    </pre>
    <p class="muted">Obs: systemet loggar alltid beslut och skäl i snapshots så att man kan granska i efterhand.</p>
  </div>
</div>

<div class="grid">
  <div class="card">
    <h4>Positionsstorlek (viktig detalj)</h4>
    <p class="muted">Systemet undviker inte automatiskt “små marknader” — det skalar ner.</p>
    <ul>
      <li>Start: <span class="mono">PM_ORDER_SIZE_SHARES</span>.</li>
      <li>Cap 1: <span class="mono">LEAD_LAG_HARD_CAP_USDC</span> (absolut tak).</li>
      <li>Cap 2: band-likviditet i orderboken inom slippage-bandet * <span class="mono">LEAD_LAG_MAX_FRACTION_OF_BAND_LIQUIDITY</span>.</li>
      <li>Om den cap:ade storleken blir för liten (&lt; <span class="mono">LEAD_LAG_MIN_TRADE_NOTIONAL_USDC</span>) → skip med skäl <span class="mono">insufficient_liquidity</span>.</li>
    </ul>
  </div>
  <div class="card">
    <h4>Var man ser att det funkar</h4>
    <ul>
      <li><span class="mono">edge_calculator_live.csv</span>: rå edge, spread, fees, net edge + <em>reason</em>.</li>
      <li><span class="mono">pm_paper_candidates.csv</span>: per marknad: decision + reason (varför det blev trade/skip).</li>
      <li><span class="mono">pm_paper_trades.csv</span>: paper fills/skips.</li>
      <li><span class="mono">live_status.json</span>: gates, latens, och senaste tick-status.</li>
    </ul>
  </div>
</div>

<div class="grid">
  <div class="card" style="grid-column: span 12;">
    <h4>Gå vidare</h4>
    <p class="muted">Nästa steg: se hur logiken ser ut i praktiken — och jämför med verkliga snapshots.</p>
    <div class="actions" style="justify-content:flex-start;">
      <a class="btn" href="#/strategy/flow">2.2 Hur systemet tänker</a>
      <a class="btn" href="#/data">Data & exempel</a>
    </div>
  </div>
</div>
