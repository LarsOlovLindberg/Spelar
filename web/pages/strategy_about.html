<h2>Om strategin</h2>

<p><strong>Idén är enkel:</strong> vi handlar <em>trend i Polymarket-priset</em> – utan extern referens. När en outcome-token börjar röra sig uppåt (tillräckligt snabbt) antar vi att rörelsen kan fortsätta en bit, går in tidigt, kan skala in om trenden fortsätter, och går ut när trenden är borta.</p>

<div class="grid">
  <div class="card">
    <h4>Vad vi mäter</h4>
    <p class="muted">Allt bygger på Polymarket CLOB (orderbok) – best bid/ask och mid.</p>
    <ul>
      <li><strong>pm_mid</strong>: (bid+ask)/2 för token</li>
      <li><strong>pm_ret_pct</strong>: % rörelse över ett kort fönster</li>
      <li><strong>spread_cost_pct</strong> &amp; fees: uppskattade kostnader</li>
    </ul>
  </div>
  <div class="card">
    <h4>Så systemet agerar</h4>
    <ul>
      <li>Identifierar när token börjar trenda upp</li>
      <li>Väljer sida automatiskt (YES/NO) per marknad</li>
      <li>Går ut när trenden avtar (eller via stop/max hold)</li>
    </ul>
  </div>
</div>

<h3>Viktiga förtydliganden</h3>
<ul>
  <li>Ingen extern referens: <strong>ingen Kraken/spot</strong> i besluten</li>
  <li>Ingen “håll till slutet”-logik: positioner är tänkta att vara korta</li>
  <li>Vi handlar prisrörelse i tokens – det innebär exponering medan positionen är öppen</li>
</ul>

<h3>Exakt strategi (pm_trend)</h3>
<p><strong>Syfte:</strong> haka på en påbörjad trend i Polymarket-priset med strikt riskkontroll. Vi försöker inte förutsäga slututfall; vi försöker handla <em>rörelsen</em>.</p>

<div class="grid">
  <div class="card" style="grid-column: span 12;">
    <h4>Inputs (per marknad)</h4>
    <ul>
      <li><strong>Pris</strong>: Polymarket CLOB best bid/ask och mid för en outcome-token.</li>
      <li><strong>Tid</strong>: tick-loop (typiskt var <span class="mono">INTERVAL_S</span> sekund).</li>
      <li><strong>Trend</strong>: rullande mid-historik och % rörelse över <span class="mono">PM_TREND_LOOKBACK_POINTS</span>.</li>
      <li><strong>Auto-sida</strong>: jämför YES och NO inom samma marknad och väljer den sida som trendar bäst (<span class="mono">PM_TREND_AUTO_SIDE</span>).</li>
    </ul>
  </div>
</div>

<div class="grid">
  <div class="card">
    <h4>Definitioner</h4>
    <ul>
      <li><strong>pm_ret_pct</strong>: procentuell rörelse för PM mid över ett kort fönster.</li>
      <li><strong>edge_pct</strong>: i <span class="mono">pm_trend</span> är edge samma sak som <strong>pm_ret_pct</strong> (trendstyrka).</li>
      <li><strong>spread_cost_pct</strong>: uppskattad kostnad i procentenheter från half-spread (entry vs mid).</li>
      <li><strong>fees_pct</strong>: uppskattad fee + extra cost (konfig) i procentenheter.</li>
      <li><strong>net_edge_pct</strong> = edge_pct − spread_cost_pct − fees_pct.</li>
    </ul>
  </div>
  <div class="card">
    <h4>Auto-sida (YES/NO)</h4>
    <ul>
      <li>Systemet skapar en kandidat för <strong>YES</strong> och en för <strong>NO</strong> (om marknaden är tvåsidig).</li>
      <li>Det väljer <em>en</em> sida att handla: den med bäst trend (högst <strong>pm_ret_pct</strong>).</li>
      <li>Det kan inte gå in i båda sidor samtidigt för samma marknad (reason t.ex. <span class="mono">not_best_side</span> / <span class="mono">other_side_open</span>).</li>
    </ul>
  </div>
</div>

<div class="grid">
  <div class="card" style="grid-column: span 12;">
    <h4>Per tick (pseudo)</h4>
    <pre class="mono" style="white-space:pre-wrap;line-height:1.35;">
for each market:
  1) fetch PM orderbook (bid/ask/mid)
  2) update rolling history and compute:
    pm_ret_pct over PM_TREND_LOOKBACK_POINTS
    edge_pct = pm_ret_pct
  3) compute spread_cost_pct from PM bid/ask
  4) (optional) auto-side selection (PM_TREND_AUTO_SIDE):
    - compare YES vs NO trend and pick best side
  5) entry precondition:
    edge_pct >= PM_TREND_MOVE_MIN_PCT
  6) quality gates (after-cost & microstructure):
       - spread gate: spread_cost_pct <= LEAD_LAG_SPREAD_COST_CAP_PCT
       - net edge gate: net_edge_pct >= LEAD_LAG_NET_EDGE_MIN_PCT
       - liquidity gate: cap size by visible band liquidity (ask..ask+slippage_cap)
       - min notional: require max_usdc >= LEAD_LAG_MIN_TRADE_NOTIONAL_USDC
       - throttle: max orders per tick
  7) if enter_ok: paper BUY (outcome token) and start tracking position
  8) if in position:
    - scale in when price moves in our favor
    - exit when trend fades: edge_pct <= PM_TREND_EXIT_MOVE_MIN_PCT
    - plus stop / max hold
    </pre>
    <p class="muted">Obs: flera risk-gates råkar fortfarande heta <span class="mono">LEAD_LAG_*</span> (legacy prefix), men de används även i <span class="mono">pm_trend</span> som generella kostnads-/likviditetsfilter.</p>
  </div>
</div>

<div class="grid">
  <div class="card">
    <h4>Positionsstorlek (viktig detalj)</h4>
    <p class="muted">Systemet undviker inte automatiskt “små marknader” — det skalar ner.</p>
    <ul>
      <li>Start: <span class="mono">PM_ORDER_SIZE_SHARES</span>.</li>
      <li>Cap 1: <span class="mono">LEAD_LAG_HARD_CAP_USDC</span> (absolut tak).</li>
      <li>Cap 2: band-likviditet i orderboken inom slippage-bandet * <span class="mono">LEAD_LAG_MAX_FRACTION_OF_BAND_LIQUIDITY</span>.</li>
      <li>Om den cap:ade storleken blir för liten (&lt; <span class="mono">LEAD_LAG_MIN_TRADE_NOTIONAL_USDC</span>) → skip med skäl <span class="mono">insufficient_liquidity</span>.</li>
    </ul>
  </div>
  <div class="card">
    <h4>Var man ser att det funkar</h4>
    <ul>
      <li><span class="mono">edge_calculator_live.csv</span>: trend/edge, spread/fees, net edge + <em>reason</em>.</li>
      <li><span class="mono">pm_paper_candidates.csv</span>: per marknad: decision + reason (varför det blev trade/skip).</li>
      <li><span class="mono">pm_paper_trades.csv</span>: paper fills/skips.</li>
      <li><span class="mono">live_status.json</span>: gates, latens, och senaste tick-status.</li>
    </ul>
  </div>
</div>

<div class="grid">
  <div class="card" style="grid-column: span 12;">
    <h4>Gå vidare</h4>
    <p class="muted">Nästa steg: se hur logiken ser ut i praktiken — och jämför med verkliga snapshots.</p>
    <div class="actions" style="justify-content:flex-start;">
      <a class="btn" href="#/strategy/flow">2.2 Hur systemet tänker</a>
      <a class="btn" href="#/data">Data & exempel</a>
    </div>
  </div>
</div>
